# Weekly Wrapped Newsletter Backend - Environment Variables Template
# 
# This is a template for the .env file with detailed explanations.
# Copy this to .env and fill in your values:
#   cp .env.template .env
#
# IMPORTANT: Never commit .env to git!

# ============================================================================
# REQUIRED CONFIGURATION
# ============================================================================

# Server Port
# - Use 8081 to avoid conflicts with TikTok Wrapped Backend (8080)
# - Must be different from other services on the same server
PORT=8081

# Database Connection
# - Use a dedicated database for this project
# - Format: postgresql+psycopg://username:password@host:port/database
# - Example: postgresql+psycopg://user:pass@localhost:5432/weekly_wrapped_newsletter
DATABASE_URL=postgresql+psycopg://user:pass@host:5432/weekly_wrapped_newsletter

# Secret Key for Token Encryption
# - Generate with: openssl rand -hex 32
# - Must be at least 32 characters
# - Keep this secret and unique per project
SECRET_KEY=

# Archive API Configuration
# - Base URL of the Archive service
# - API key for authentication
ARCHIVE_BASE_URL=http://localhost:8012
ARCHIVE_API_KEY=

# ============================================================================
# AWS CONFIGURATION (for email and S3)
# ============================================================================

# AWS SES (Simple Email Service) - for sending emails
# - Email address to send from (must be verified in SES)
# - Reply-to address for user responses
AWS_EMAIL="Weekly Wrapped <noreply@example.com>"
AWS_REPLY_TO=team@teleport.computer

# AWS Credentials
# - Prefer IAM roles on EC2 instead of keys
# - If using keys, never commit them to git
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-1

# AWS S3 - for file uploads
# - Bucket name for storing uploads
# - Prefix for organizing files in the bucket
# - Public URL (CloudFront or S3) for accessing files
S3_BUCKET=feedling
S3_UPLOAD_PREFIX=weekly-uploads
S3_URL=https://diiz1ua008deo.cloudfront.net

# ============================================================================
# WEEKLY REPORT CONFIGURATION
# ============================================================================

# Weekly Token for Cron Endpoints
# - Generate with: openssl rand -hex 32
# - Used to authenticate weekly report triggers
WEEKLY_TOKEN=

# Node.js Service Configuration (for generating email HTML)
# - URL: The frontend service that generates email HTML from report data
# - Token: Optional authentication token for the Node.js service
# - API format: POST {"uid": "app_user_id", "params": {...report_fields...}}
# - Response format: {"data": {}, "html": "...email_html..."}
WEEKLY_REPORT_NODE_URL=https://weekly-wrapped-newsletter-frontend.vercel.app/api/wrapped
WEEKLY_REPORT_NODE_TOKEN=

# Weekly Report Settings
# - Grace period in hours for data coverage
# - Maximum number of concurrent data fetch jobs
WEEKLY_REPORT_COVERAGE_GRACE_HOURS=0
WEEKLY_REPORT_FETCH_MAX_DATA_JOBS=8

# ============================================================================
# WRAPPED (YEARLY REPORT) CONFIGURATION
# ============================================================================

# Disable Auto Wrapped
# - Set to "true" to disable automatic yearly report generation on user authorization
# - Admin manual endpoints (/admin/test-run) will still work
# - Useful when only using weekly reports and not yearly wrapped
DISABLE_AUTO_WRAPPED=true

# ============================================================================
# OPTIONAL CONFIGURATION
# ============================================================================

# Logging Configuration
# - Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# - Maximum characters to log for request/response bodies
LOG_LEVEL=INFO
LOG_BODY_MAX_CHARS=8000

# Session Configuration
# - Number of days before user sessions expire
SESSION_TTL_DAYS=30

# CORS Configuration
# - Allowed origins for Cross-Origin Resource Sharing
# - Use "*" for all origins, or comma-separated list
# - Example: "https://example.com,https://app.example.com"
CORS_ALLOW_ORIGINS=*

# Admin API Key (optional)
# - Enable admin endpoints with this key
# - Leave empty to disable admin endpoints
ADMIN_API_KEY=

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================

# Worker Concurrency
# - Number of jobs to process concurrently per worker process
# - Adjust based on server resources and job complexity
WORKER_JOB_CONCURRENCY=10

# Job Lease Configuration
# - Seconds to lease a job before it can be picked up by another worker
# - Should be longer than typical job execution time
WORKER_JOB_LEASE_SECONDS=60

# Worker Heartbeat
# - Seconds between worker heartbeat updates
# - Should be less than lease seconds
WORKER_JOB_HEARTBEAT_SECONDS=30

# Worker Poll Interval
# - Seconds to wait between checking for new jobs
# - Lower = more responsive, higher = less database load
WORKER_POLL_INTERVAL=1.0

# ============================================================================
# WATCH HISTORY CONFIGURATION
# ============================================================================

# Watch History Date Range
# - Start date for fetching watch history (YYYY-MM-DD)
# - Or use milliseconds since epoch (WATCH_HISTORY_SINCE_MS)
WATCH_HISTORY_SINCE_DATE=2025-01-01
# WATCH_HISTORY_SINCE_MS=1735689600000

# Watch History Fetch Limits
# - Number of items per page
# - Maximum number of pages to fetch per job
WATCH_HISTORY_PAGE_LIMIT=200
WATCH_HISTORY_MAX_PAGES=3

# ============================================================================
# GUNICORN CONFIGURATION (optional)
# ============================================================================

# Gunicorn Workers
# - Number of worker processes
# - Default: CPU count / 2
# GUNICORN_WORKERS=4

# Gunicorn Worker Class
# - Default: uvicorn.workers.UvicornWorker
# GUNICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker

# Gunicorn Timeout
# - Request timeout in seconds
# GUNICORN_TIMEOUT=120

# Gunicorn Logging
# - Access log path (use "-" for stdout)
# - Error log path (use "-" for stderr)
# GUNICORN_ACCESS_LOG=-
# GUNICORN_ERROR_LOG=-

# ============================================================================
# HTTPS CONFIGURATION (optional)
# ============================================================================

# Enable HTTPS in Container
# - Set to "true" to enable HTTPS
# - Requires valid certificate files
# HTTPS_ON=false

# Certificate Files
# - Full path to SSL certificate and key
# - Must be accessible inside the container
# GUNICORN_CERTFILE=/certbot/live/yourdomain.com/fullchain.pem
# GUNICORN_KEYFILE=/certbot/live/yourdomain.com/privkey.pem

# ============================================================================
# NOTES
# ============================================================================

# Security Best Practices:
# 1. Never commit .env to version control
# 2. Use strong, unique SECRET_KEY and WEEKLY_TOKEN
# 3. Restrict .env file permissions: chmod 600 .env
# 4. Use IAM roles on AWS instead of access keys when possible
# 5. Regularly rotate credentials and tokens

# Performance Tuning:
# 1. Adjust WORKER_JOB_CONCURRENCY based on server resources
# 2. Increase WATCH_HISTORY_MAX_PAGES for faster historical data fetch
# 3. Adjust GUNICORN_WORKERS based on CPU cores and traffic
# 4. Monitor and adjust LOG_LEVEL (use WARNING or ERROR in production)

# Multi-Project Setup:
# - If running alongside TikTok Wrapped Backend:
#   * Use different PORT (8081 vs 8080)
#   * Use different DATABASE_URL (different database name)
#   * Use different SECRET_KEY
#   * Use different WEEKLY_TOKEN
# - Container names are already configured to not conflict

# For more information, see:
# - QUICK_START.md - Quick deployment guide
# - DEPLOYMENT.md - Complete deployment documentation
# - PROJECT_COMPARISON.md - Comparison with TikTok Wrapped
